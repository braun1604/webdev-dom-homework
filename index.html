<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="comments"></ul>
      <div class="add-form">
        <input id="input"
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea id="textarea"
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="button">Написать</button>
        </div>
      </div>
    </div>
  </body>

  <script>
    "use strict";
    const now = new Date()
    const day = now.getDate().toString().padStart(2, '0')
    const month = (now.getMonth() + 1).toString().padStart(2, '0')
    const year = now.getFullYear().toString().slice(-2)
    const hours = now.getHours().toString().padStart(2, '0')
    const minutes = now.getMinutes().toString().padStart(2, '0')
    const formattedDate = `${day}.${month}.${year} ${hours}:${minutes}`
    const buttonEl = document.getElementById('button');
    const inputEl = document.getElementById('input');
    const textareaEl = document.getElementById('textarea');
    const commentsEl = document.getElementById('comments');
    
    const comments = [
      {
        name: "Глеб Фокин",
        data: "12.02.22 12:18",
        text: "Это будет первый комментарий на этой странице",
        isLiked: false,
        likeCount: 3
        },
        {
        name: "Варвара Н.",
        data: "13.02.22 19:22",
        text: "Мне нравится как оформлена эта страница! ❤",
        isLiked: true,
        likeCount: 75
        },
      ];
      
      const renderComments = () => {
      const commentsHtml = comments.map((commentary, index) => {
        const classButton = commentary.isLiked ? "-active-like" : ""; 
        return `<li class="comment" >
          <div class="comment-header" >
            <div data-index="${index}">${commentary.name}</div>
            <div>${commentary.data}</div>
          </div>
          <div class="comment-body">
            <div class="comment-text" data-index="${index}">
              ${commentary.text} 
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span  class="likes-counter" data-index="${index}">${commentary.likeCount}</span>
              <button class="like-button ${classButton}"  data-index="${index}"></button>
            </div>
          </div>
        </li>`
      }).join('');
      commentsEl.innerHTML = commentsHtml;
      initEventListener();
      
    }

      function initEventListener(){
      const likeButtonEls = document.querySelectorAll('.like-button');
    for (const likeButtonEl of likeButtonEls) {
      likeButtonEl.addEventListener('click', () => {
       const index = likeButtonEl.dataset.index
       if (comments[index].isLiked) {
        comments[index].isLiked = !comments[index].isLiked
        comments[index].likeCount--
      } else {
        comments[index].isLiked = !comments[index].isLiked
        comments[index].likeCount++
      }
      renderComments();
    })
  }
}

const copyText = () => {
  commentsEl.addEventListener('click', (event) => {
    let target = event.target
    if (!target.classList.contains('comment-text')) {
      return
    }
    const currentHeader = document.querySelector(`[data-index="${event.target.dataset.index}"]`);
    textareaEl.value = `>${target.textContent.replace(/\s/g, ' ').trim()}\n${
          currentHeader.textContent.replace(/\s/g, ' ').trim()}`
          event.stopPropagation()
  })
}

    buttonEl.addEventListener('click', function (e) {
       const inputElement = inputEl.value;
      const textareaElement = textareaEl.value;
      if (inputElement.trim() === '' || textareaElement.trim() === '') {
        alert('Введите данные корректно')
        return 
      }
      comments.push({
        name: inputElement
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;"),
        data: formattedDate,
        text: textareaElement
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;"),
        isLiked: false,
        likeCount: 0
      })
      renderComments();
    });
    renderComments();
    copyText();
  
   
   
  </script>
</html>